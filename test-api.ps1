# Test the Christmas Party Feedback SystemWrite-Host ""Write-Host "Testing Christmas Party Feedback System" -ForegroundColor GreenWrite-Host "========================================" -ForegroundColor GreenWrite-Host ""# Wait a moment for server to fully startStart-Sleep -Seconds 2# Test 1: Check if server is runningWrite-Host "Test 1: Server Health Check" -ForegroundColor Cyantry {    $response = Invoke-WebRequest -Uri "http://localhost:3000" -UseBasicParsing -TimeoutSec 5    Write-Host "SUCCESS: Server is running on http://localhost:3000" -ForegroundColor Green} catch {    Write-Host "FAILED: Server not responding" -ForegroundColor Red    exit 1}# Test 2: Test check endpointWrite-Host ""Write-Host "Test 2: Testing /api/check endpoint" -ForegroundColor Cyantry {    $testUserId = "test-user-$(Get-Random)"    $body = @{ user_id = $testUserId } | ConvertTo-Json    $response = Invoke-RestMethod -Uri "http://localhost:3000/api/check" -Method POST -Body $body -ContentType "application/json"        if ($response.exists -eq $false) {        Write-Host "SUCCESS: Check API works correctly" -ForegroundColor Green    } else {        Write-Host "WARNING: Unexpected response" -ForegroundColor Yellow    }} catch {    Write-Host "FAILED: Check API error: $_" -ForegroundColor Red}# Test 3: Submit feedbackWrite-Host ""Write-Host "Test 3: Submitting test feedback" -ForegroundColor Cyantry {    $testUserId = "test-user-$(Get-Random)"    $body = @{        user_id = $testUserId        ratings = @{            food = 5            venue = 4            decor = 5            photobooth = 3            giveaways = 4            emcees = 5            games = 4            department_presentations = 5            raffle = 3            loyalty_awards = 5        }        comment = "Test submission from PowerShell"        name = "Test User"        department = "QA"    } | ConvertTo-Json -Depth 3        $response = Invoke-RestMethod -Uri "http://localhost:3000/api/submit" -Method POST -Body $body -ContentType "application/json"        if ($response.success -eq $true) {        Write-Host "SUCCESS: Feedback submitted successfully" -ForegroundColor Green        Write-Host "  Message: $($response.message)" -ForegroundColor Gray    } else {        Write-Host "FAILED: Submission failed" -ForegroundColor Red    }} catch {    Write-Host "FAILED: Submit API error: $_" -ForegroundColor Red}# Test 4: Check if feedback exists nowWrite-Host ""Write-Host "Test 4: Verifying feedback was saved" -ForegroundColor Cyantry {    $checkBody = @{ user_id = $testUserId } | ConvertTo-Json    $response = Invoke-RestMethod -Uri "http://localhost:3000/api/check" -Method POST -Body $checkBody -ContentType "application/json"        if ($response.exists -eq $true) {        Write-Host "SUCCESS: Feedback retrieved from database" -ForegroundColor Green        Write-Host "  User: $($response.feedback.name) ($($response.feedback.department))" -ForegroundColor Gray        Write-Host "  Food rating: $($response.feedback.ratings.food)/5" -ForegroundColor Gray    } else {        Write-Host "FAILED: Feedback not found in database" -ForegroundColor Red    }} catch {    Write-Host "FAILED: Check API error: $_" -ForegroundColor Red}# Test 5: Update feedback (UPSERT test)Write-Host ""Write-Host "Test 5: Testing UPSERT (update existing feedback)" -ForegroundColor Cyantry {    $updateBody = @{        user_id = $testUserId        ratings = @{            food = 3            venue = 4            decor = 5            photobooth = 3            giveaways = 4            emcees = 5            games = 4            department_presentations = 5            raffle = 3            loyalty_awards = 5        }        comment = "UPDATED: Test submission from PowerShell"        name = "Updated Test User"        department = "QA Updated"    } | ConvertTo-Json -Depth 3        $response = Invoke-RestMethod -Uri "http://localhost:3000/api/submit" -Method POST -Body $updateBody -ContentType "application/json"        if ($response.success -eq $true) {        Write-Host "SUCCESS: Feedback updated (UPSERT works!)" -ForegroundColor Green    } else {        Write-Host "FAILED: Update failed" -ForegroundColor Red    }} catch {    Write-Host "FAILED: Update error: $_" -ForegroundColor Red}# SummaryWrite-Host ""Write-Host "Test Summary" -ForegroundColor GreenWrite-Host "============" -ForegroundColor GreenWrite-Host "All core functionality is working!" -ForegroundColor GreenWrite-Host ""Write-Host "Next Steps:" -ForegroundColor CyanWrite-Host "  1. Open http://localhost:3000 in your browser" -ForegroundColor White
Write-Host "  2. Fill out the feedback form" -ForegroundColor White
Write-Host "  3. Submit and see the success screen" -ForegroundColor White
Write-Host "  4. Refresh the page - your feedback should pre-fill" -ForegroundColor White
Write-Host "  5. View database: npx prisma studio" -ForegroundColor White
Write-Host ""
Write-Host "Server is running at: http://localhost:3000" -ForegroundColor Green
Write-Host ""
